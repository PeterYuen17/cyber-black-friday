<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Online Black Friday</title>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js">
        </script>
		<script>
			function buy()
			{
				if(validate("stockId") == false) {return;}
				if(validate("userNum") == false) {return;}
			
				document.getElementById("complete").innerHTML = '';
				document.getElementById("info").innerHTML = '';
			
				var stockId = document.getElementById("stockId").value;
				var userNum = document.getElementById("userNum").value;
			
				document.getElementById("info").innerHTML = 'Start sending requests...    -    ' + Date();
				for (var i=1; i<=userNum; i++)
				{
					var Http = new XMLHttpRequest();
					var url = 'http://localhost:8081/blackfriday/order/'+ stockId +'/redis-order/'+ i;
					Http.open("POST", url);
					Http.send();
				}
				document.getElementById("complete").innerHTML = 'Complete!    -    ' + Date();
			}
			
			function buy2()
			{
				if(validate("stockId") == false) {return;}
				if(validate("userNum") == false) {return;}
			
				document.getElementById("complete").innerHTML = '';
				document.getElementById("info").innerHTML = '';
			
				var stockId = document.getElementById("stockId").value;
				var userNum = document.getElementById("userNum").value;
			
				document.getElementById("info").innerHTML = 'Start sending requests...    -    ' + Date();
				for (var i=1; i<=userNum; i++)
				{
					var settings = 
					{
						"url": 'http://localhost:8081/blackfriday/order/'+ stockId +'/redis-order/'+ i,
						"method": "POST",
						"timeout": 0,
					};

					$.ajax(settings).done(function (response) {});
				}
				document.getElementById("complete").innerHTML = 'Complete!    -    ' + Date();
			}
			
			function validate(id)
			{
				document.getElementById("complete").innerHTML = '';
			
				var value = document.getElementById(""+id).value;
				var reg=/^[1-9]\d*$|^0$/;
				
				if(reg.test(value) == false)
				{ 
					document.getElementById("info").innerHTML = 'Invalid ' + id; 
					return false;
				}
				
				else { document.getElementById("info").innerHTML = ''; }
				
				return true;
			}
		</script>
	</head>

	<body>
		<h1>Online Black Friday</h1>
		
		<form id="form1">
			<table border="0">
				<tr>
					<td>stockId: </td>
					<td><input id="stockId" name="stockId" type="text" onblur="validate(this.id)"/></td>
				</tr>
			
				<tr>
					<td>Number of Users: </td>
					<td><input id="userNum" name="userNum" type="text" onblur="validate(this.id)"/></td>
				</tr>
			</table>
		</form>
		
		<button type="button" onclick="buy()">Start!</button>
			
		<p id="info"></p>
		<p id="complete"></p>
	</body>
</html>